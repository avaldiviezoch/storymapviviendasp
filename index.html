<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üìä Biblioteca ‚Äî Pruebas Estad√≠sticas y Mapas en HTML</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg:#0b1020; --panel:#0f172a; --ink:#e5e7eb; --muted:#9aa4b2; --stroke:#1c2542;
      --btn1:#60a5fa; --btn2:#34d399; --btn3:#f59e0b; --btn4:#a78bfa;
      --shadow: 0 10px 24px rgba(0,0,0,.25);
      --pv-w: 520px;       /* ancho del recuadro de preview */
      --pv-h: 320px;       /* alto del recuadro de preview  */
      --base-w: 1280px;    /* tama√±o base que ‚Äúsimula‚Äù la p√°gina dentro del iframe */
      --base-h: 800px;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f6f8fc; --panel:#ffffff; --ink:#0f172a; --muted:#5b6472; --stroke:#e6eaf0; --shadow: 0 14px 30px rgba(16,24,40,.08); }
    }
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial}

    .wrap{max-width:1100px; margin:0 auto; padding:18px}
    h1{margin:0 0 8px; font-size:1.4rem; font-weight:900}
    .sub{color:var(--muted); margin-bottom:14px}

    /* Panel retr√°ctil */
    details{ background: color-mix(in oklab, var(--panel) 96%, transparent); border:1px solid var(--stroke); border-radius:14px; box-shadow:var(--shadow); overflow:hidden; margin:12px 0 }
    summary{ cursor:pointer; list-style:none; padding:14px 16px; display:flex; gap:10px; align-items:center; font-weight:800 }
    summary::-webkit-details-marker{ display:none }
    .chev{transition: transform .2s ease; opacity:.9}
    details[open] .chev{ transform: rotate(180deg) }
    .section{ padding:14px 16px 18px; border-top:1px solid var(--stroke) }

    /* Grid de botones */
    .grid{ display:grid; gap:10px; grid-template-columns: repeat(auto-fill, minmax(230px, 1fr)); }
    .btn{
      display:block; text-decoration:none; color:inherit; font-weight:800;
      padding:14px 16px; border-radius:12px; border:1px solid var(--stroke);
      background: linear-gradient(135deg, color-mix(in oklab, var(--btn1) 38%, transparent), color-mix(in oklab, var(--panel) 85%, transparent));
      box-shadow: var(--shadow); transition: transform .12s ease, filter .12s ease;
    }
    .btn:hover{ transform: translateY(-2px); filter: brightness(1.05) }
    .btn:focus-visible{ outline:3px solid color-mix(in oklab, var(--btn1) 50%, transparent) }

    .v2{ background: linear-gradient(135deg, color-mix(in oklab, var(--btn2) 38%, transparent), color-mix(in oklab, var(--panel) 85%, transparent)); }
    .v3{ background: linear-gradient(135deg, color-mix(in oklab, var(--btn3) 38%, transparent), color-mix(in oklab, var(--panel) 85%, transparent)); }
    .v4{ background: linear-gradient(135deg, color-mix(in oklab, var(--btn4) 38%, transparent), color-mix(in oklab, var(--panel) 85%, transparent)); }

    .note{ color:var(--muted); font-size:.9rem; margin-top:12px }

    /* ===== Vista previa con iframe (miniatura real) ===== */
    .preview {
      position: fixed; z-index: 1000; display: none;
      width: var(--pv-w); height: var(--pv-h);
      background: var(--panel); color: var(--ink);
      border: 1px solid var(--stroke); border-radius: 12px;
      box-shadow: var(--shadow); padding: 8px; gap: 8px;
      pointer-events: none;  /* evita captura del mouse por el iframe */
    }
    .pv-wrap{
      position: relative; width: 100%; height: calc(100% - 28px);
      border-radius: 10px; overflow: hidden; background: #00000012;
      border: 1px solid var(--stroke);
    }
    .pv-frame{
      position:absolute; top:0; left:0; border:0; width: var(--base-w); height: var(--base-h);
      transform-origin: 0 0;
      pointer-events: none;   /* sin interacci√≥n dentro del preview */
    }
    .pv-cap{ font-size:.85rem; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .pv-overlay{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      font-size:.9rem; color:var(--muted); background: linear-gradient(to bottom, #0000, #00000018);
      opacity: 0; transition: opacity .15s ease;
    }
    .preview.loading .pv-overlay{ opacity: 1; }
    .preview.blocked .pv-overlay{ opacity: 1; color:#fca5a5 }
    @media (max-width: 700px){
      :root{ --pv-w: 92vw; --pv-h: 52vw; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üìä Biblioteca ‚Äî Botones simples</h1>
    <div class="sub">Interfaz de visualizaciones para Storymaps (con previsualizaci√≥n real en miniatura).</div>

    <!-- Secci√≥n: Gr√°ficos -->
    <details>
      <summary>
        <svg class="chev" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
        üìà Gr√°ficos
      </summary>
      <div class="section">
        <div class="grid">
          <a class="btn"  href="grafico-urbano-rural.html"      target="_blank">Urbano vs Rural</a>
          <a class="btn v2" href="grafica-lineas-joseruben.html" target="_blank">Gr√°fica de L√≠neas ‚Äî Jose Rub√©n</a>
          <a class="btn v3" href="doble-grafico-1.html"          target="_blank">Doble Gr√°fico 1</a>
          <a class="btn v2" href="bonos-techo-propio.html"       target="_blank">Bonos Techo Propio</a>
          <a class="btn v3" href="bonos-niveles-prueba.html"     target="_blank">Bonos Niveles (Prueba)</a>
          <a class="btn v4" href="prueba-christian-1.html"       target="_blank">Prueba Christian 1</a>
          <a class="btn"  href="prueba-christian-2.html"         target="_blank">Prueba Christian 2</a>
          <a class="btn v2" href="prueba-christian-3.html"       target="_blank">Prueba Christian 3</a>
          <a class="btn v3" href="prueba-christian-4.html"       target="_blank">Prueba Christian 4</a>
          <a class="btn v4" href="prueba-christian-6.html"       target="_blank">Prueba Christian 6</a>
          <!-- NUEVOS -->
          <a class="btn v4" href="indicador-presupuesto1.html"   target="_blank">Indicador Presupuesto 1</a>
          <a class="btn v2" href="indicador-presupuesto2.html"   target="_blank">Indicador Presupuesto 2</a>
          <!-- /NUEVOS -->
        </div>
        <div class="note">Si una p√°gina impide incrustaci√≥n, agrega <code>data-thumb</code> con una miniatura para ese bot√≥n.</div>
      </div>
    </details>

    <!-- Secci√≥n: Mapas -->
    <details>
      <summary>
        <svg class="chev" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
        üó∫Ô∏è Mapas
      </summary>
      <div class="section">
        <div class="grid">
          <a class="btn"  href="mapa-prueba-1.html"          target="_blank">Mapa Prueba 1</a>
          <a class="btn v2" href="prueba-mapa-2.html"        target="_blank">Mapa Prueba 2</a>
          <a class="btn v3" href="mapa-prueba-3.html"        target="_blank">Mapa Prueba 3</a>
          <a class="btn v4" href="prueba-mapa-4.html"        target="_blank">Mapa Prueba 4</a>
          <a class="btn"  href="prueba-mapa-cluster.html"    target="_blank">Mapa Cluster</a>
          <a class="btn v2" href="prueba-mapa-5.html"        target="_blank">Mapa Cluster 2</a>
          <a class="btn v3" href="prueba-mapa-3-partes.html" target="_blank">Mapa 3 partes</a>
          <a class="btn v4" href="lista-indicadores-mapa.html" target="_blank">Lista de Indicadores ‚Äî Mapa</a>
        </div>
      </div>
    </details>
  </div>

  <!-- Contenedor de vista previa -->
  <div id="preview" class="preview" role="status" aria-live="polite" aria-hidden="true">
    <div class="pv-wrap">
      <iframe id="pvframe" class="pv-frame" sandbox="allow-scripts allow-same-origin"></iframe>
      <div id="pvover" class="pv-overlay">Cargando vista previa‚Ä¶</div>
    </div>
    <div id="pvcap" class="pv-cap"></div>
  </div>

  <script>
    const isCoarse = window.matchMedia && window.matchMedia('(pointer: coarse)').matches;
    const preview = document.getElementById('preview');
    const pvframe = document.getElementById('pvframe');
    const pvover  = document.getElementById('pvover');
    const pvcap   = document.getElementById('pvcap');

    // Escala el iframe al tama√±o del recuadro de preview
    function applyScale(){
      const wrapW = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--pv-w'));
      const baseW = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--base-w'));
      const baseH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--base-h'));
      const wrapH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--pv-h')) - 28; // resta altura del caption aprox
      const scaleX = wrapW / baseW;
      const scaleY = wrapH / baseH;
      const scale = Math.min(scaleX, scaleY);
      pvframe.style.transform = `scale(${scale})`;
    }
    applyScale();
    window.addEventListener('resize', applyScale);

    let hoverTimer = null;
    let currentURL = '';

    function showPreview(anchor, ev){
      if(isCoarse) return;
      const href = anchor.getAttribute('href');
      const label = anchor.textContent.trim();
      pvcap.textContent = label;

      // Posicionamiento cerca del cursor (con l√≠mites seguros)
      let x, y;
      if(ev && 'clientX' in ev){ x = ev.clientX + window.scrollX; y = ev.clientY + window.scrollY; }
      else {
        const r = anchor.getBoundingClientRect(); x = r.left + r.width/2 + window.scrollX; y = r.bottom + window.scrollY;
      }
      const pad=16, w=preview.offsetWidth||520, h=preview.offsetHeight||340;
      let left = x + pad, top = y + pad;
      const vw = window.scrollX + window.innerWidth, vh = window.scrollY + window.innerHeight;
      if(left + w > vw - 8) left = x - w - pad;
      if(top + h > vh - 8) top = y - h - pad;
      preview.style.left = left + 'px'; preview.style.top = top + 'px';

      // Muestra el contenedor y setea estado
      preview.style.display = 'block';
      preview.classList.add('loading');
      preview.classList.remove('blocked');
      preview.setAttribute('aria-hidden','false');

      // Peque√±a espera para evitar recargas por pasadas r√°pidas
      clearTimeout(hoverTimer);
      hoverTimer = setTimeout(()=>{
        if(currentURL !== href){
          currentURL = href;
          pvover.textContent = 'Cargando vista previa‚Ä¶';
          preview.classList.add('loading');
          pvframe.src = href;
        }
      }, 140);
    }

    function hidePreview(){
      preview.style.display = 'none';
      preview.setAttribute('aria-hidden','true');
      clearTimeout(hoverTimer);
    }

    // Detecta carga o bloqueo del iframe
    pvframe.addEventListener('load', ()=>{
      // Quitamos ‚Äúcargando‚Äù; si el sitio bloquea, el navegador puede no mostrar nada.
      preview.classList.remove('loading');
      // Si tras un momento no hay nada visible, marcamos como bloqueado (heur√≠stica).
      setTimeout(()=>{
        // No podemos inspeccionar contenido por CORS; solo mostramos aviso gen√©rico.
      }, 250);
    });

    // Si el origen bloquea la incrustaci√≥n, el navegador puede lanzar errores silenciosos;
    // ofrecemos un time-out para mostrar aviso.
    function markBlocked(){
      preview.classList.remove('loading');
      preview.classList.add('blocked');
      pvover.textContent = 'Vista previa no disponible (sitio restringe incrustaci√≥n).';
    }
    // Fallback de bloqueo por timeout
    let blockTimer = null;
    document.addEventListener('mouseover', (e)=>{
      const a = e.target.closest('a.btn'); if(!a) return;
      showPreview(a, e);
      clearTimeout(blockTimer);
      blockTimer = setTimeout(()=>{ 
        // Si sigue en estado loading demasiado tiempo, asumimos bloqueo
        if(preview.style.display==='block' && preview.classList.contains('loading')) markBlocked();
      }, 1500);
    });

    document.addEventListener('mousemove', (e)=>{
      if(preview.style.display==='block'){
        const a = e.target.closest('a.btn') || document.querySelector('a.btn:focus');
        if(a) showPreview(a, e);
      }
    });

    document.addEventListener('mouseout', (e)=>{
      const leavingBtn = e.target.closest('a.btn');
      if(leavingBtn && !(e.relatedTarget && e.relatedTarget.closest && e.relatedTarget.closest('#preview'))){
        hidePreview();
      }
    });

    // Accesible con teclado
    document.addEventListener('focusin', e=>{
      const a = e.target.closest && e.target.closest('a.btn'); if(a) showPreview(a, null);
    });
    document.addEventListener('focusout', e=>{
      const a = e.target.closest && e.target.closest('a.btn'); if(a) hidePreview();
    });

    // Oculta al hacer scroll
    window.addEventListener('scroll', ()=>{ if(preview.style.display==='block') hidePreview(); });
  </script>
</body>
</html>

