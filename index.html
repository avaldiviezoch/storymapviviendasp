<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üìä Biblioteca ‚Äî Pruebas Estadisticas y Mapas en html</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg:#0b1020; --panel:#0f172a; --ink:#e5e7eb; --muted:#9aa4b2; --stroke:#1c2542;
      --btn1:#60a5fa; --btn2:#34d399; --btn3:#f59e0b; --btn4:#a78bfa;
      --shadow: 0 10px 24px rgba(0,0,0,.25);
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f6f8fc; --panel:#ffffff; --ink:#0f172a; --muted:#5b6472; --stroke:#e6eaf0; --shadow: 0 14px 30px rgba(16,24,40,.08); }
    }
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial}

    .wrap{max-width:1100px; margin:0 auto; padding:18px}
    h1{margin:0 0 8px; font-size:1.4rem; font-weight:900}
    .sub{color:var(--muted); margin-bottom:14px}

    /* Panel retr√°ctil */
    details{ background: color-mix(in oklab, var(--panel) 96%, transparent); border:1px solid var(--stroke); border-radius:14px; box-shadow:var(--shadow); overflow:hidden; margin:12px 0 }
    summary{ cursor:pointer; list-style:none; padding:14px 16px; display:flex; gap:10px; align-items:center; font-weight:800 }
    summary::-webkit-details-marker{ display:none }
    .chev{transition: transform .2s ease; opacity:.9}
    details[open] .chev{ transform: rotate(180deg) }
    .section{ padding:14px 16px 18px; border-top:1px solid var(--stroke) }

    /* Grid de botones */
    .grid{ display:grid; gap:10px; grid-template-columns: repeat(auto-fill, minmax(230px, 1fr)); }
    .btn{
      display:block; text-decoration:none; color:inherit; font-weight:800;
      padding:14px 16px; border-radius:12px; border:1px solid var(--stroke);
      background: linear-gradient(135deg, color-mix(in oklab, var(--btn1) 38%, transparent), color-mix(in oklab, var(--panel) 85%, transparent));
      box-shadow: var(--shadow); transition: transform .12s ease, filter .12s ease;
    }
    .btn:hover{ transform: translateY(-2px); filter: brightness(1.05) }
    .btn:focus-visible{ outline:3px solid color-mix(in oklab, var(--btn1) 50%, transparent) }
    .v2{ background: linear-gradient(135deg, color-mix(in oklab, var(--btn2) 38%, transparent), color-mix(in oklab, var(--panel) 85%, transparent)); }
    .v3{ background: linear-gradient(135deg, color-mix(in oklab, var(--btn3) 38%, transparent), color-mix(in oklab, var(--panel) 85%, transparent)); }
    .v4{ background: linear-gradient(135deg, color-mix(in oklab, var(--btn4) 38%, transparent), color-mix(in oklab, var(--panel) 85%, transparent)); }

    .note{ color:var(--muted); font-size:.9rem; margin-top:12px }

    /* ===== Vista previa flotante ===== */
    .preview {
      position: fixed; z-index: 1000; display: none;
      width: 360px; max-width: 46vw;
      background: var(--panel); color: var(--ink);
      border: 1px solid var(--stroke); border-radius: 12px;
      box-shadow: var(--shadow); padding: 8px;
      pointer-events: none;
    }
    .preview img {
      display: block; width: 100%; height: auto; border-radius: 8px; background: #00000012;
    }
    .preview .cap { font-size: .85rem; color: var(--muted); margin-top: 6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üìä Biblioteca ‚Äî Botones simples</h1>
    <div class="sub">Interfaz de visualizaciones para Storymaps (con vista previa al pasar el mouse).</div>

    <!-- Secci√≥n: Gr√°ficos -->
    <details>
      <summary>
        <svg class="chev" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
        üìà Gr√°ficos
      </summary>
      <div class="section">
        <div class="grid">
          <a class="btn" href="grafico-urbano-rural.html" target="_blank">Urbano vs Rural</a>
          <a class="btn v2" href="grafica-lineas-joseruben.html" target="_blank">Gr√°fica de L√≠neas ‚Äî Jose Rub√©n</a>
          <a class="btn v2" href="bonos-techo-propio.html" target="_blank">Bonos Techo Propio</a>
          <a class="btn v3" href="bonos-niveles-prueba.html" target="_blank">Bonos Niveles (Prueba)</a>
          <a class="btn v4" href="prueba-christian-1.html" target="_blank">Prueba Christian 1</a>
          <a class="btn" href="prueba-christian-2.html" target="_blank">Prueba Christian 2</a>
          <a class="btn v2" href="prueba-christian-3.html" target="_blank">Prueba Christian 3</a>
          <a class="btn v3" href="prueba-christian-4.html" target="_blank">Prueba Christian 4</a>
          <a class="btn v4" href="prueba-christian-6.html" target="_blank">Prueba Christian 6</a>
        </div>
        <div class="note">Opcional: coloca miniaturas en <code>/thumbs/</code> con el mismo nombre del HTML o usa <code>data-thumb</code> por bot√≥n.</div>
      </div>
    </details>

    <!-- Secci√≥n: Mapas -->
    <details>
      <summary>
        <svg class="chev" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
        üó∫Ô∏è Mapas
      </summary>
      <div class="section">
        <div class="grid">
          <a class="btn" href="mapa-prueba-1.html" target="_blank">Mapa Prueba 1</a>
          <a class="btn v2" href="prueba-mapa-2.html" target="_blank">Mapa Prueba 2</a>
          <a class="btn v3" href="mapa-prueba-3.html" target="_blank">Mapa Prueba 3</a>
          <a class="btn v4" href="prueba-mapa-4.html" target="_blank">Mapa Prueba 4</a>
          <a class="btn" href="prueba-mapa-cluster.html" target="_blank">Mapa Cluster</a>
          <a class="btn v2" href="prueba-mapa-5.html" target="_blank">Mapa Cluster 2</a>
          <a class="btn v3" href="prueba-mapa-3-partes.html" target="_blank">Mapa 3 partes</a>
          <a class="btn v4" href="lista-indicadores-mapa.html" target="_blank">Lista de Indicadores ‚Äî Mapa</a>
        </div>
      </div>
    </details>
  </div>

  <!-- Contenedor de vista previa -->
  <div id="preview" class="preview" role="status" aria-live="polite" aria-hidden="true">
    <img id="pvimg" alt="Vista previa" />
    <div id="pvcap" class="cap"></div>
  </div>

  <script>
    // Desactiva preview en t√°ctiles
    const isCoarse = window.matchMedia && window.matchMedia('(pointer: coarse)').matches;

    const preview = document.getElementById('preview');
    const pvimg = document.getElementById('pvimg');
    const pvcap = document.getElementById('pvcap');

    // Genera una miniatura SVG con el texto del bot√≥n (fallback siempre √∫til)
    function svgPreviewFromText(text){
      const palette = [
        ['#7dd3fc','#38bdf8'], // celeste
        ['#86efac','#22c55e'], // verde
        ['#fca5a5','#ef4444'], // rojo
        ['#c4b5fd','#8b5cf6'], // violeta
        ['#fcd34d','#f59e0b'], // √°mbar
        ['#93c5fd','#3b82f6']  // azul
      ];
      // hash simple
      let h=0; for(let i=0;i<text.length;i++) h=(h*31+text.charCodeAt(i))>>>0;
      const [c1,c2] = palette[h % palette.length];
      const safe = text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
      const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="640" height="360" viewBox="0 0 640 360">
          <defs>
            <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
              <stop stop-color="${c1}" offset="0"/>
              <stop stop-color="${c2}" offset="1"/>
            </linearGradient>
          </defs>
          <rect width="640" height="360" fill="url(#g)"/>
          <g fill="#0f172a" opacity=".25">
            <rect x="90" y="90" width="460" height="200" rx="16"/>
            <path d="M120 250h400M120 210h290M120 170h340" stroke="#0f172a" stroke-width="8" opacity=".35"/>
          </g>
          <text x="50%" y="52%" font-family="system-ui,Arial" font-size="32" font-weight="700" text-anchor="middle" fill="#0f172a">${safe}</text>
        </svg>`;
      return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
    }

    function deriveBaseName(href){
      const url = href.split('?')[0].split('#')[0];
      return url.substring(url.lastIndexOf('/')+1).replace(/\.html?$/i,'');
    }

    // Intenta .webp -> .png -> .jpg. Si ninguna existe, queda el SVG de texto.
    function tryLoadThumb(anchor, onSuccess){
      const custom = anchor.getAttribute('data-thumb');
      const base = custom || ('thumbs/' + deriveBaseName(anchor.getAttribute('href')));
      const candidates = custom ? [custom] : [base+'.webp', base+'.png', base+'.jpg'];

      let i = 0;
      const tryNext = () => {
        if(i >= candidates.length) return;
        const test = new Image();
        test.onload = () => { anchor.dataset.pv = candidates[i]; onSuccess(candidates[i]); };
        test.onerror = () => { i++; tryNext(); };
        test.src = candidates[i] + '?v=1'; // cache-buster suave
      };
      tryNext();
    }

    function showPreviewFor(anchor, fromEvent){
      if (isCoarse) return;
      const label = anchor.textContent.trim();
      pvcap.textContent = label;

      // Usa cache si existe; si no, muestra SVG textual y prueba a cargar real.
      const cached = anchor.dataset.pv;
      if(cached){
        pvimg.src = cached;
      } else {
        pvimg.src = svgPreviewFromText(label);
        tryLoadThumb(anchor, (real)=>{ if(preview.style.display==='block') pvimg.src = real; });
      }

      // Posici√≥n
      let x,y;
      if(fromEvent && 'clientX' in fromEvent){
        x = fromEvent.clientX + window.scrollX;
        y = fromEvent.clientY + window.scrollY;
      } else {
        const r = anchor.getBoundingClientRect();
        x = r.left + r.width/2 + window.scrollX;
        y = r.bottom + window.scrollY;
      }

      preview.style.display = 'block';
      preview.setAttribute('aria-hidden','false');

      // Bordes seguros
      const pad=16, w=preview.offsetWidth||360, h=preview.offsetHeight||220;
      let left = x + pad, top = y + pad;
      const vw = window.scrollX + window.innerWidth, vh = window.scrollY + window.innerHeight;
      if(left + w > vw - 8) left = x - w - pad;
      if(top + h > vh - 8) top = y - h - pad;
      preview.style.left = left + 'px';
      preview.style.top  = top + 'px';
    }

    function hidePreview(){
      preview.style.display = 'none';
      preview.setAttribute('aria-hidden','true');
      // no limpiamos src para mantener cache instant√°neo
    }

    // Eventos (hover/teclado)
    document.addEventListener('mouseover', e => {
      const a = e.target.closest('a.btn'); if(!a) return; showPreviewFor(a, e);
    });
    document.addEventListener('mousemove', e => {
      if(preview.style.display==='block'){
        const a = e.target.closest('a.btn') || document.querySelector('a.btn:focus');
        if(a) showPreviewFor(a, e);
      }
    });
    document.addEventListener('mouseout', e => {
      const leavingBtn = e.target.closest('a.btn');
      if(leavingBtn && !(e.relatedTarget && e.relatedTarget.closest && e.relatedTarget.closest('#preview'))){
        hidePreview();
      }
    });
    document.addEventListener('focusin', e => {
      const a = e.target.closest && e.target.closest('a.btn'); if(a) showPreviewFor(a, null);
    });
    document.addEventListener('focusout', e => {
      const a = e.target.closest && e.target.closest('a.btn'); if(a) hidePreview();
    });
    window.addEventListener('scroll', () => { if(preview.style.display==='block') hidePreview(); });
  </script>
</body>
</html>
